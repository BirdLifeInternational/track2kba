library(track2KBA)
KBAs <- findKBA(KDE.Surface, Represent=repr$out, popSize = popsize, polyOut = T, plot=T)
KBAs <- findKBA(KDE.Surface$KDE.Surface, Represent=repr$out, popSize = popsize, polyOut = T, plot=T)
debug(findKBA)
KBAs <- findKBA(KDE.Surface$KDE.Surface, Represent=repr$out, popSize = popsize, polyOut = T, plot=T)
potentialKBA
KBA_sf %>% dplyr::filter(.data$potentialKBA==TRUE) %>%
ggplot() +
borders("world", fill="dark grey", colour="grey20") +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
axis.text=element_text(size=11, colour="black"),
axis.title=element_text(size=14),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
guides(colour=FALSE) +
scale_fill_continuous(name = "Prop. of animals") +
ylab("Latitude") +
xlab("Longitude")
KBA_sf %>% dplyr::filter(.data$potentialKBA==TRUE) %>%
ggplot() +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
axis.text=element_text(size=11, colour="black"),
axis.title=element_text(size=14),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
guides(colour=FALSE) +
scale_fill_continuous(name = "N animals") +
ylab("Latitude") +
xlab("Longitude")
KBA_sf
KBA_sf %>% ggplot() +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
axis.text=element_text(size=11, colour="black"),
axis.title=element_text(size=14),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
guides(colour=FALSE) +
scale_fill_continuous(name = "N animals") +
ylab("Latitude") +
xlab("Longitude")
plot(st_intersection(KBA_sf$potentialKBA))
?st_intersection()
plot(aggregate(KBA_sf, by="potentialKBA"))
plot(KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)))
plot(KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE))
denseplot <-  KBA_sf %>% dplyr::filter(.data$N_animals > 0) %>% gplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
denseplot <-  KBA_sf %>% dplyr::filter(.data$N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
denseplot
denseplot <-  KBA_sf %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
denseplot
potKBAarea <- KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot + geom_sf(mapping = aes(colour=.data$potentialKBA), data=potKBAarea)
ggplot() + geom_sf(mapping = aes(colour=.data$potentialKBA), data=potKBAarea)
ggplot() + geom_sf(mapping = aes(colour=.data$potentialKBA), fill=NA, data=potKBAarea)
ggplot() + geom_sf(colour=.data$potentialKBA, fill=NA, data=potKBAarea)
ggplot() + geom_sf(data=potKBAarea, colour=.data$potentialKBA, fill=NA)
ggplot() + geom_sf(data=potKBAarea, fill=NA)
ggplot() + geom_sf(data=potKBAarea, colour="red", fill=NA)
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA)
denseplot <-  KBA_sf %>% dplyr::filter(.data$N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7")
denseplot <-  KBA_sf %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
denseplot <-  KBA_sf %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7")
denseplot
denseplot <-  KBA_sf %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colorur_continuous(high = "#132B43", low = "#56B1F7")
denseplot
denseplot <- KBA_sf %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7")
denseplot
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA)
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7")
potKBAarea <- KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA)
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
potKBAarea <- KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA)
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA)
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA)
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
potKBAarea <- KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA)
KBA_sf %>% dplyr::filter(.data$potentialKBA==TRUE) %>%
ggplot() +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
axis.text=element_text(size=11, colour="black"),
axis.title=element_text(size=14),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
guides(colour=FALSE) +
scale_fill_continuous(name = "N animals") +
ylab("Latitude") +
xlab("Longitude")
KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE) +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
any(KBA_sf$potentialKBA == TRUE)
quiet
sink(  denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE))
?sink
?coord_sf
cf coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
csf <- coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
csf$default
csf$default <- TRUE
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", fill=scales::alpha("dark grey", 0.6), colour="grey20") +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
potKBAarea <- KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", color="dark grey", fill = NA)
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", color="dark grey", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
# if any areas are potentialKBAs, add red border
if(any(KBA_sf$potentialKBA == TRUE)) {
potKBAarea <- KBA_sf %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
}
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", color="grey", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="grey", fill = NA) +
csf
KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="grey", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7")
KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="grey", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)
KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="grey", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1))
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot + geom_sf(data=potKBAarea, colour="red", size=1.5 fill=NA) +
csf
denseplot + geom_sf(data=potKBAarea, colour="red", size=1.5 fill=NA) +
csf
denseplot + geom_sf(data=potKBAarea, colour="red", size=1.5, fill=NA) +
csf
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA, size=1.1) +
csf
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA, size=1) +
csf
denseplot + geom_sf(data=potKBAarea, mapping=aes(colour="red"), fill=NA, size=1) +
csf
denseplot + geom_sf(data=potKBAarea, mapping=aes(colour=potentialKBA), fill=NA, size=1) +
csf
denseplot + geom_sf(data=potKBAarea, mapping=aes(colour="red"), fill=NA, size=1) +
csf
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA, size=1) +
csf +
scale_fill_manual(values = "red", labels = 'Potential KBA')
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA, size=1) +
csf +
scale_colour_manual(values = "red", labels = 'Potential KBA')
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA, size=1) +
csf
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7") +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +
xlab("Longitude")
denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA, size=1) +
csf
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +
xlab("Longitude")
denseplot <- denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot + scale_fill_continuous(high = "#132B43", low = "#56B1F7")
denseplot + scale_fill_continuous(high = "#132B43", low = "#56B1F7", name = "N animals")
label <- "N animals"
denseplot <- KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7", name = label) +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +
xlab("Longitude")
denseplot <- denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot
KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7", name = label) +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +
xlab("Longitude")
KBA_sf %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7", name = label) +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +  xlab("Longitude") + guides(colour=FALSE)
KBAs <- findKBA(KDE.Surface$KDE.Surface, Represent=repr$out, popSize = popsize, polyOut = F, plot=T)
potentialKBA
plot(potentialKBA)
plot(KBA)
KBA <- potentialKBA
plot(KBA)
Colony
denseplot
colony <- tracks[1,] %>% dplyr::select(lon_colony,lat_colony) %>%
dplyr::rename(Longitude=lon_colony,Latitude=lat_colony)
### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ###
#### CONVERT OUTPUT INTO POLYGONS WITH KBA ASSESSMENT INFO
### ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ###
### the first step is very slow
KBApoly <- as(potentialKBA, "SpatialPolygonsDataFrame")
potentialKBA <- NULL
### aggregate all pixel-sized polygons into big polygons with the same number of birds
OUTMAP <- raster::aggregate(KBApoly, c('N_animals','N_IND','potentialKBA'))
KBApoly <- NULL
### CONVERT INTO SIMPLE FEATURE AS OUTPUT AND FOR PLOTTING
KBA_sf <- sf::st_as_sf(OUTMAP) %>%
sf::st_union(by_feature = TRUE) %>%
smoothr::smooth(method = "densify") %>%
sf::st_transform(4326) %>%
arrange(.data$N_IND)
coordsets <- sf::st_bbox(KBA)
csf <- coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
csf$default <- TRUE
label <- "N animals"
denseplot <- KBA %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7", name = label) +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +  xlab("Longitude") + guides(colour=FALSE)
KBA
KBA <- KBA_sf
coordsets <- sf::st_bbox(KBA)
csf <- coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
csf$default <- TRUE
label <- "N animals"
denseplot <- KBA %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7", name = label) +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +  xlab("Longitude") + guides(colour=FALSE)
potKBAarea <- KBA %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot <- denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA) +
csf
denseplot + geom_point(data=colony, aes(x=.data$Longitude, y=.data$Latitude), col='red', shape=16, size=2)
denseplot + geom_point(data=colony, aes(x=.data$Longitude, y=.data$Latitude), col='orange', shape=16, size=2)
denseplot + geom_point(data=colony, aes(x=.data$Longitude, y=.data$Latitude), col='dark orange', shape=16, size=2)
mapKBA <- function(KBA, Colony=NULL, Show=TRUE) {
if(class(KBA)[1] == "sf"){
coordsets <- sf::st_bbox(KBA)
csf <- coord_sf(xlim = c(coordsets$xmin, coordsets$xmax), ylim = c(coordsets$ymin, coordsets$ymax), expand = FALSE)
csf$default <- TRUE
if(any(KBA$N_animals > 1)) {
label <- "N animals"
} else {
label <- "Prop. animals"
}
denseplot <- KBA %>% filter(N_animals > 0) %>% ggplot() +
geom_sf(mapping = aes(fill=.data$N_animals, colour=.data$N_animals)) +
borders("world", colour="black", fill = NA) +
csf +
scale_fill_continuous(high = "#132B43", low = "#56B1F7", name = label) +
scale_colour_continuous(high = "#132B43", low = "#56B1F7") +
theme(panel.background=element_blank(),
panel.grid.major=element_line(colour="transparent"),
panel.grid.minor=element_line(colour="transparent"),
panel.border = element_rect(colour = "black", fill=NA, size=1)) +
ylab("Latitude") +  xlab("Longitude") + guides(colour=FALSE)
# if any areas are potentialKBAs, add red border
if(any(KBA$potentialKBA == TRUE)) {
potKBAarea <- KBA %>% group_by(potentialKBA) %>% summarise(N_animals = max(N_animals)) %>% filter(potentialKBA==TRUE)
denseplot <- denseplot + geom_sf(data=potKBAarea, colour="red", fill=NA, size=1.1) +
csf
}
if(!is.null(Colony)){
denseplot <- denseplot +
geom_point(data=Colony, aes(x=.data$Longitude, y=.data$Latitude), col='dark orange', shape=16, size=2)
}
if(Show == TRUE){
print(denseplot)
} else { return(denseplot) }
} else if(class(KBA) == "SpatialPixelsDataFrame") {
denseplot <- plot(KBA)
return(denseplot)
}
}
library(track2KBA)
KBA_sf <- findKBA(KDE.Surface$KDE.Surface, Represent=repr$out, popSize = popsize, polyOut = T)
KBA_sp <- findKBA(KDE.Surface, Represent=repr$out, polyOut = F, plot=T)
KBA_sp <- findKBA(KDE.Surface, Represent=repr$out, polyOut = F)
debug(findKBA)
KBA_sp <- findKBA(KDE.Surface, Represent=repr$out, polyOut = F)
KBA_sp <- findKBA(KDE.Surface$KDE.Surface, Represent=repr$out, polyOut = F)
undebug(findKBA)
KBA_sp <- findKBA(KDE.Surface$KDE.Surface, Represent=repr$out, polyOut = F)
mapKBA(KBA_sf, Colony = colony)
library(track2KBA)
KBA_sf
mapKBA(KBA_sf, Colony = colony)
library(track2KBA)
mapKBA(KBA_sf, Colony = colony)
debug(mapKBA)
mapKBA(KBA_sf, Colony = colony)
coordsets <- sf::st_bbox(KBA)
library(track2KBA)
mapKBA
library(track2KBA)
mapKBA
